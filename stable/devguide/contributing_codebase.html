<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Contributing to the code &mdash; SpectroChemPy v0.4.7 0.4.7 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_override.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery-rendered-html.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/scpy.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Contributing to specific parts of the code" href="contributing_codespecifics.html" />
    <link rel="prev" title="Contributing to SpectroChemPy" href="contributing.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html">
            <img src="../_static/scpy.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.4.7
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">

    <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
      <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> SpectroChemPy </span>
        version: stable
        <span class="fa fa-caret-down"></span>
      </span>
        <div class="rst-other-versions">
            <dl>
                <dt>Other versions</dt>
                
                    
                        <dd><a href="https://www.spectrochempy.fr/latest/index.html"">LATEST</a></dd>
                    
                
                    
                
            </dl>
            <hr/>
            <dl>
                <dt>Sources on GitHub</dt>
                <dd><a href="https://github.com/spectrochempy/spectrochempy/releases/latest">Stable</a></dd>
                <dd><a href="https://github.com/spectrochempy/spectrochempy/tree/master/">Latest</a></dd>

            </dl>

        </div>
    </div>

    
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../gettingstarted/whyscpy.html">Why <strong>SpectroChemPy</strong>  ?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gettingstarted/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gettingstarted/gallery/auto_examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gettingstarted/install/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gettingstarted/papers.html">Papers citing <strong>SpectroChemPy</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User's Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userguide/introduction/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/objects.html">Data structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/importexport/importexport.html">Import &amp; Export</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/plotting/plotting.html">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/processing/processing.html">Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/analysis/analysis.html">Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/units/units.html">Units &amp; Quantities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/databases/databases.html">Databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/api/api.html">API Configuration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference &amp; Help</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../userguide/reference/changelog.html">What’s new</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/reference/index.html">Public API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/reference/faq.html">Frequently asked questions (FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="issues.html">Bug reports &amp; feature request</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Sharing examples &amp; tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="contributing.html">Contributing to SpectroChemPy</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Contributing to the code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#code-standards">Code standards</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pre-commit">Pre-commit</a></li>
<li class="toctree-l3"><a class="reference internal" href="#optional-dependencies">Optional dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testing-with-continuous-integration">Testing with continuous integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#test-driven-development-code-writing">Test-driven development/code writing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-the-test-suite">Running the test suite</a></li>
<li class="toctree-l3"><a class="reference internal" href="#documenting-change-log">Documenting change log</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="contributing_codespecifics.html">Contributing to specific parts of the code</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing_documentation.html">Contributing to the documentation</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Credits</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../credits/credits.html">Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credits/credits.html#third-party-licences">Third-party Licences</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credits/citing.html">Citing  <strong>SpectroChemPy</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../credits/license.html">SpectroChempy License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credits/license.html#other-licenses">Other Licenses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credits/seealso.html">See also</a></li>
</ul>



        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SpectroChemPy v0.4.7</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Developer’s Guide</a> &raquo;</li>
      <li>Contributing to the code</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/devguide/contributing_codebase.rst" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
    
    
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="contributing-to-the-code">
<span id="contributing-codebase"></span><h1>Contributing to the code<a class="headerlink" href="#contributing-to-the-code" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">Table of Contents:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#code-standards" id="id2">Code standards</a></p></li>
<li><p><a class="reference internal" href="#pre-commit" id="id3">Pre-commit</a></p></li>
<li><p><a class="reference internal" href="#optional-dependencies" id="id4">Optional dependencies</a></p>
<ul>
<li><p><a class="reference internal" href="#python-pep8-black" id="id5">Python (PEP8 / black)</a></p></li>
<li><p><a class="reference internal" href="#backwards-compatibility" id="id6">Backwards compatibility</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#testing-with-continuous-integration" id="id7">Testing with continuous integration</a></p></li>
<li><p><a class="reference internal" href="#test-driven-development-code-writing" id="id8">Test-driven development/code writing</a></p>
<ul>
<li><p><a class="reference internal" href="#writing-tests" id="id9">Writing tests</a></p></li>
<li><p><a class="reference internal" href="#using-pytest" id="id10">Using <code class="docutils literal notranslate"><span class="pre">pytest</span></code></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#running-the-test-suite" id="id11">Running the test suite</a></p></li>
<li><p><a class="reference internal" href="#documenting-change-log" id="id12">Documenting change log</a></p></li>
</ul>
</div>
<section id="code-standards">
<h2><a class="toc-backref" href="#id2">Code standards</a><a class="headerlink" href="#code-standards" title="Permalink to this headline">¶</a></h2>
<p>During <a class="reference internal" href="#contributing-ci"><span class="std std-ref">Continuous Integration</span></a> testing, several
tools will be run to check your code for stylistic errors.
Generating any warnings will cause the test to fail.
Thus, good style is a requirement for submitting code to SpectroChemPy.</p>
<p>In addition, it is important that we
do not make sudden changes to the code that could have the potential to break
a lot of user code as a result, that is, we need it to be as <em>backwards compatible</em>
as possible to avoid mass breakages.</p>
<p>Some extra checks can be run by
<code class="docutils literal notranslate"><span class="pre">pre-commit</span></code> - see <a class="reference internal" href="#contributing-pre-commit"><span class="std std-ref">here</span></a> for how to
run them.</p>
<p>Additional standards are outlined on the <a class="reference internal" href="code_style.html#code-style"><span class="std std-ref">spectrochempy code style guide</span></a>.</p>
</section>
<section id="pre-commit">
<span id="contributing-pre-commit"></span><h2><a class="toc-backref" href="#id3">Pre-commit</a><a class="headerlink" href="#pre-commit" title="Permalink to this headline">¶</a></h2>
<p>We encourage you to use <code class="xref py py-obj docutils literal notranslate"><span class="pre">pre-commit</span> <span class="pre">hooks</span></code>
to automatically run <code class="docutils literal notranslate"><span class="pre">black</span></code>, <code class="docutils literal notranslate"><span class="pre">flake8</span></code> when you make a git commit. This
can be done by installing <code class="docutils literal notranslate"><span class="pre">pre-commit</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pre</span><span class="o">-</span><span class="n">commit</span>
</pre></div>
</div>
<p>and then running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pre</span><span class="o">-</span><span class="n">commit</span> <span class="n">install</span>
</pre></div>
</div>
<p>from the root of the spectrochempy repository. Now all of the styling checks will be
run each time you commit changes without your needing to run each one manually.
In addition, using <code class="docutils literal notranslate"><span class="pre">pre-commit</span></code> will also allow you to more easily
remain up to date with our code checks as they change.</p>
<p>Note that if needed, you can skip these checks with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span> <span class="pre">--no-verify</span></code>.</p>
<p>If you don’t want to use <code class="docutils literal notranslate"><span class="pre">pre-commit</span></code> as part of your workflow, you can still use it
to run its checks with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pre</span><span class="o">-</span><span class="n">commit</span> <span class="n">run</span> <span class="o">--</span><span class="n">files</span> <span class="o">&lt;</span><span class="n">files</span> <span class="n">you</span> <span class="n">have</span> <span class="n">modified</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>without needing to have done <code class="docutils literal notranslate"><span class="pre">pre-commit</span> <span class="pre">install</span></code> beforehand.</p>
<p>If you want to run checks on all recently committed files on upstream/master you can use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pre</span><span class="o">-</span><span class="n">commit</span> <span class="n">run</span> <span class="o">--</span><span class="n">from</span><span class="o">-</span><span class="n">ref</span><span class="o">=</span><span class="n">upstream</span><span class="o">/</span><span class="n">master</span> <span class="o">--</span><span class="n">to</span><span class="o">-</span><span class="n">ref</span><span class="o">=</span><span class="n">HEAD</span> <span class="o">--</span><span class="nb">all</span><span class="o">-</span><span class="n">files</span>
</pre></div>
</div>
<p>without needing to have done <code class="docutils literal notranslate"><span class="pre">pre-commit</span> <span class="pre">install</span></code> beforehand.</p>
</section>
<section id="optional-dependencies">
<h2><a class="toc-backref" href="#id4">Optional dependencies</a><a class="headerlink" href="#optional-dependencies" title="Permalink to this headline">¶</a></h2>
<p>Optional dependencies (e.g., cantera, nmrglue, …) should be imported with the private helper
<code class="docutils literal notranslate"><span class="pre">spectrochempy.optional.import_optional_dependency</span></code>. This ensures a
consistent error message when the dependency is not met.</p>
<p>All methods using an optional dependency should include a test asserting that an
<code class="docutils literal notranslate"><span class="pre">ImportError</span></code> is raised when the optional dependency is not found. This test
should be skipped if the library is present.</p>
<p>All optional dependencies should be documented in
<a class="reference internal" href="../gettingstarted/install/install_adds.html#install-adds"><span class="std std-ref">Install optional dependencies</span></a> and the minimum required version should be
set in the <code class="docutils literal notranslate"><span class="pre">spectrochempy.optional.VERSIONS</span></code> dict.</p>
<section id="python-pep8-black">
<span id="contributing-code-formatting"></span><h3><a class="toc-backref" href="#id5">Python (PEP8 / black)</a><a class="headerlink" href="#python-pep8-black" title="Permalink to this headline">¶</a></h3>
<p>spectrochempy follows the <a class="reference external" href="https://www.python.org/dev/peps/pep-0008/">PEP8</a> standard
and uses <a class="reference external" href="https://black.readthedocs.io/en/stable/">Black</a> and
<a class="reference external" href="http://flake8.pycqa.org/en/latest/">Flake8</a> to ensure a consistent code
format throughout the project. We encourage you to use <a class="reference internal" href="#contributing-pre-commit"><span class="std std-ref">pre-commit</span></a>.</p>
<p><a class="reference internal" href="#contributing-ci"><span class="std std-ref">Continuous Integration</span></a> will run those tools and
report any stylistic errors in your code. Therefore, it is helpful before
submitting code to run the check yourself:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">black</span> <span class="n">spectrochempy</span>
<span class="n">git</span> <span class="n">diff</span> <span class="n">upstream</span><span class="o">/</span><span class="n">master</span> <span class="o">-</span><span class="n">u</span> <span class="o">--</span> <span class="s2">&quot;*.py&quot;</span> <span class="o">|</span> <span class="n">flake8</span> <span class="o">--</span><span class="n">diff</span>
</pre></div>
</div>
<p>to auto-format your code. Additionally, many editors have plugins that will
apply <code class="docutils literal notranslate"><span class="pre">black</span></code> as you edit files.</p>
<p>One caveat about <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">diff</span> <span class="pre">upstream/master</span> <span class="pre">-u</span> <span class="pre">--</span> <span class="pre">&quot;*.py&quot;</span> <span class="pre">|</span> <span class="pre">flake8</span> <span class="pre">--diff</span></code>: this
command will catch any stylistic errors in your changes specifically, but
beware it may not catch all of them. For example, if you delete the only
usage of an imported function, it is stylistically incorrect to import an
unused function. However, style-checking the diff will not catch this because
the actual import is not part of the diff. Thus, for completeness, you should
run this command, though it may take longer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">diff</span> <span class="n">upstream</span><span class="o">/</span><span class="n">master</span> <span class="o">--</span><span class="n">name</span><span class="o">-</span><span class="n">only</span> <span class="o">--</span> <span class="s2">&quot;*.py&quot;</span> <span class="o">|</span> <span class="n">xargs</span> <span class="o">-</span><span class="n">r</span> <span class="n">flake8</span>
</pre></div>
</div>
<p>Note that on macOS, the <code class="docutils literal notranslate"><span class="pre">-r</span></code> flag is not available, so you have to omit it and
run this slightly modified command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">diff</span> <span class="n">upstream</span><span class="o">/</span><span class="n">master</span> <span class="o">--</span><span class="n">name</span><span class="o">-</span><span class="n">only</span> <span class="o">--</span> <span class="s2">&quot;*.py&quot;</span> <span class="o">|</span> <span class="n">xargs</span> <span class="n">flake8</span>
</pre></div>
</div>
<p>Windows does not support the <code class="docutils literal notranslate"><span class="pre">xargs</span></code> command (unless installed for example
via the <a class="reference external" href="http://www.mingw.org/">MinGW</a> toolchain), but one can imitate the
behavior as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="o">/</span><span class="n">f</span> <span class="o">%</span><span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;git diff upstream/master --name-only -- &quot;*.py&quot;&#39;</span><span class="p">)</span> <span class="n">do</span> <span class="n">flake8</span> <span class="o">%</span><span class="n">i</span>
</pre></div>
</div>
<p>This will get all the files being changed by the PR (and ending with <code class="docutils literal notranslate"><span class="pre">.py</span></code>),
and run <code class="docutils literal notranslate"><span class="pre">flake8</span></code> on them, one after the other.</p>
<p>Note that these commands can be run analogously with <code class="docutils literal notranslate"><span class="pre">black</span></code>.</p>
</section>
<section id="backwards-compatibility">
<h3><a class="toc-backref" href="#id6">Backwards compatibility</a><a class="headerlink" href="#backwards-compatibility" title="Permalink to this headline">¶</a></h3>
<p>Please try to maintain backward compatibility. If you think breakage is required,
clearly state why as part of the pull request.  Also, be careful when changing method
signatures and add deprecation warnings where needed. Also, add the deprecated sphinx
directive to the deprecated functions or methods.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">spectrochempy.utils.exceptions</span> <span class="kn">import</span> <span class="n">deprecated</span>

<span class="nd">@deprecated</span><span class="p">(</span><span class="s2">&quot;This function is deprecated and may be removed in future version&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">old_func</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Summary of the function.</span>

<span class="sd">    .. deprecated:: 1.1.0</span>
<span class="sd">       Use new_func instead.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">new_func</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">new_func</span><span class="p">():</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>You’ll also need to</p>
<ol class="arabic simple">
<li><p>Write a new test that asserts a warning is issued when calling with the deprecated argument</p></li>
<li><p>Update all of spectrochempy existing tests and code to use the new argument.</p></li>
</ol>
</section>
</section>
<section id="testing-with-continuous-integration">
<span id="contributing-ci"></span><h2><a class="toc-backref" href="#id7">Testing with continuous integration</a><a class="headerlink" href="#testing-with-continuous-integration" title="Permalink to this headline">¶</a></h2>
<p>The spectrochempy test suite will run automatically on <code class="xref py py-obj docutils literal notranslate"><span class="pre">GitHub</span> <span class="pre">Actions</span></code>,
once your pull request is submitted.</p>
<p>A pull-request will be considered for merging when you have an all ‘green’ build. If any tests are failing,
then you will get a red ‘X’, where you can click through to see the individual failed tests.</p>
</section>
<section id="test-driven-development-code-writing">
<span id="contributing-tdd"></span><h2><a class="toc-backref" href="#id8">Test-driven development/code writing</a><a class="headerlink" href="#test-driven-development-code-writing" title="Permalink to this headline">¶</a></h2>
<p>SpectroChemPy strongly encourages contributors to embrace
<a class="reference external" href="https://en.wikipedia.org/wiki/Test-driven_development">test-driven development (TDD)</a>.
This development process “relies on the repetition of a very short development cycle:
first the developer writes an (initially failing) automated test case that defines a desired
improvement or new function, then produces the minimum amount of code to pass that test.”
So, before actually writing any code, you should write your tests.  Often the test can be
taken from the original GitHub issue.  However, it is always worth considering additional
use cases and writing corresponding tests.</p>
<p>Adding tests is one of the most common requests after code is pushed to spectrochempy.  Therefore,
it is worth getting in the habit of writing tests ahead of time so this is never an issue.</p>
<p>Like many packages, spectrochempy uses <a class="reference external" href="https://docs.pytest.org/en/latest/">pytest</a> and the convenient
extensions in <a class="reference external" href="https://numpy.org/doc/stable/reference/routines.testing.html">numpy.testing</a>.</p>
<section id="writing-tests">
<h3><a class="toc-backref" href="#id9">Writing tests</a><a class="headerlink" href="#writing-tests" title="Permalink to this headline">¶</a></h3>
<p>All tests should go into the <code class="docutils literal notranslate"><span class="pre">tests</span></code> directory.
This folder contains many current examples of tests, and we suggest looking to these for
inspiration.  If your test requires working with files or
network connectivity, there is more information on the <a class="reference external" href="https://github.com/spectrochempy-dev/spectrochempy/wiki/Testing">testing page</a> of the wiki.</p>
<p>The easiest way to verify that your code is correct is to
explicitly construct the result you expect, then compare the actual result to
the expected correct result.</p>
</section>
<section id="using-pytest">
<h3><a class="toc-backref" href="#id10">Using <code class="docutils literal notranslate"><span class="pre">pytest</span></code></a><a class="headerlink" href="#using-pytest" title="Permalink to this headline">¶</a></h3>
<p>Here is an example of a self-contained set of tests that illustrate multiple features that we like to use.</p>
<ul class="simple">
<li><p>functional style: tests are like <code class="docutils literal notranslate"><span class="pre">test_*</span></code> and <em>only</em> take arguments that are either fixtures or parameters</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pytest.mark</span></code> can be used to set metadata on test functions, e.g. <code class="docutils literal notranslate"><span class="pre">skip</span></code> or <code class="docutils literal notranslate"><span class="pre">xfail</span></code>.</p></li>
<li><p>using <code class="docutils literal notranslate"><span class="pre">parametrize</span></code>: allow testing of multiple cases</p></li>
<li><p>to set a mark on a parameter, <code class="docutils literal notranslate"><span class="pre">pytest.param(...,</span> <span class="pre">marks=...)</span></code> syntax should be used</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fixture</span></code>, code for object construction, on a per-test basis</p></li>
<li><p>using bare <code class="docutils literal notranslate"><span class="pre">assert</span></code> for scalars and truth-testing</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">assert_dataset_equal</span></code> for spectrochempy object comparisons.</p></li>
<li><p>the typical pattern of constructing an <code class="docutils literal notranslate"><span class="pre">expected</span></code> and comparing versus the <code class="docutils literal notranslate"><span class="pre">result</span></code></p></li>
</ul>
<p>We would name this file <code class="docutils literal notranslate"><span class="pre">test_ds.py</span></code> and put in an appropriate place in the <code class="docutils literal notranslate"><span class="pre">tests/test_dataset</span></code> structure.</p>
<p>See files in <code class="docutils literal notranslate"><span class="pre">tests</span></code> directory.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">spectrochempy</span> <span class="k">as</span> <span class="nn">scp</span>
<span class="kn">from</span> <span class="nn">spectrochempy.utils.testing</span> <span class="kn">import</span> <span class="n">assert_array_equal</span>


<span class="k">def</span> <span class="nf">test_nddataset_real_imag</span><span class="p">():</span>

    <span class="n">na</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[[</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">2.0</span><span class="n">j</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="mi">0</span><span class="n">j</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.3</span> <span class="o">+</span> <span class="mf">2.0</span><span class="n">j</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="n">j</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">4.2</span><span class="n">j</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="mi">3</span><span class="n">j</span><span class="p">]])</span>
    <span class="n">nd</span> <span class="o">=</span> <span class="n">scp</span><span class="o">.</span><span class="n">NDDataset</span><span class="p">(</span><span class="n">na</span><span class="p">)</span>
    <span class="c1"># in the last dimension</span>
    <span class="n">assert_array_equal</span><span class="p">(</span><span class="n">nd</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">na</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
    <span class="n">assert_array_equal</span><span class="p">(</span><span class="n">nd</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">na</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>


<span class="n">adata</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">[],</span>
    <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.0</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="p">,</span> <span class="mf">10.0</span> <span class="o">+</span> <span class="mf">3.0</span><span class="n">j</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.0</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">+</span> <span class="mf">3.0</span><span class="n">j</span><span class="p">],</span>
<span class="p">)</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">adata</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_1D_NDDataset</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="c1"># 1D</span>
    <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">)]:</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">scp</span><span class="o">.</span><span class="n">NDDataset</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">ds</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">ds</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">size</span><span class="p">,)</span>
        <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">ds</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">assert</span> <span class="n">ds</span><span class="o">.</span><span class="n">dims</span> <span class="o">==</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">ds</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">]</span>
            <span class="k">assert</span> <span class="n">ds</span><span class="o">.</span><span class="n">dims</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>
        <span class="c1"># force dtype</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">scp</span><span class="o">.</span><span class="n">NDDataset</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">ds</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">ds</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
        <span class="k">assert</span> <span class="n">ds</span><span class="o">.</span><span class="n">title</span> <span class="o">==</span> <span class="s2">&quot;&lt;untitled&gt;&quot;</span>
        <span class="k">assert</span> <span class="n">ds</span><span class="o">.</span><span class="n">mask</span> <span class="o">==</span> <span class="n">scp</span><span class="o">.</span><span class="n">NOMASK</span>
        <span class="k">assert</span> <span class="n">ds</span><span class="o">.</span><span class="n">meta</span> <span class="o">==</span> <span class="p">{}</span>
        <span class="k">assert</span> <span class="n">ds</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;NDDataset&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">ds</span><span class="o">.</span><span class="n">author</span> <span class="o">==</span> <span class="n">get_user_and_node</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">ds</span><span class="o">.</span><span class="n">description</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">ds</span><span class="o">.</span><span class="n">history</span> <span class="o">==</span> <span class="p">[]</span>
</pre></div>
</div>
<p>A test run of this using yields:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">=============</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">======================</span>
platform darwin -- Python <span class="m">3</span>.8.8, pytest-6.2.2, py-1.10.0, pluggy-0.13.1
rootdir: spectrochempy, configfile: pytest.ini
plugins: flake8-1.0.7, anyio-2.2.0, doctestplus-0.9.0
collected <span class="m">8</span> items

tests/test_dataset/test_ds.py .......  <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">===========</span> warnings <span class="nv">summary</span> <span class="o">============================</span>
tests/test_dataset/test_ds.py::test_1D_NDDataset<span class="o">[</span>a5<span class="o">]</span>
tests/test_dataset/test_ds.py::test_1D_NDDataset<span class="o">[</span>a6<span class="o">]</span>
spectrochempy/core/dataset/ndcomplex.py:152: ComplexWarning: Casting complex values to real discards the imaginary part
 <span class="nv">data</span> <span class="o">=</span> data.astype<span class="o">(</span>np.dtype<span class="o">(</span>self._dtype<span class="o">)</span>, <span class="nv">copy</span><span class="o">=</span>False<span class="o">)</span>

-- Docs: https://docs.pytest.org/en/stable/warnings.html
<span class="o">============</span> <span class="m">8</span> passed, <span class="m">2</span> warnings <span class="k">in</span> <span class="m">0</span>.28s <span class="o">==============</span>
</pre></div>
</div>
</section>
</section>
<section id="running-the-test-suite">
<h2><a class="toc-backref" href="#id11">Running the test suite</a><a class="headerlink" href="#running-the-test-suite" title="Permalink to this headline">¶</a></h2>
<p>The tests can then be run directly inside your Git clone by typing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">code</span><span class="o">-</span><span class="n">block</span><span class="p">::</span> <span class="n">bash</span>
</pre></div>
</div>
<blockquote>
<div><p>pytest .</p>
</div></blockquote>
<p>The test suite is exhaustive and takes several minutes to run.  Often it is
worth running only a subset of tests first around your changes before running the
entire suite.</p>
<p>The easiest way to do this is with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">code</span><span class="o">-</span><span class="n">block</span><span class="p">::</span> <span class="n">bash</span>
</pre></div>
</div>
<blockquote>
<div><p>pytest spectrochempy/path/to/test.py -k regex_matching_test_name</p>
</div></blockquote>
<p>Or with one of the following constructs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">code</span><span class="o">-</span><span class="n">block</span><span class="p">::</span> <span class="n">bash</span>
</pre></div>
</div>
<blockquote>
<div><p>pytest tests/[test-module].py
pytest tests/[test-module].py::[TestClass]
pytest tests/[test-module].py::[TestClass]::[test_method]</p>
</div></blockquote>
<p>Using <a class="reference external" href="https://pypi.org/project/pytest-xdist">pytest-xdist</a>, one can
speed up local testing on multicore machines. To use this feature, you will
need to install <code class="docutils literal notranslate"><span class="pre">pytest-xdist</span></code> via:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">code</span><span class="o">-</span><span class="n">block</span><span class="p">::</span> <span class="n">bash</span>
</pre></div>
</div>
<blockquote>
<div><p>mamba install pytest-xdist</p>
</div></blockquote>
<p>This can significantly reduce the time it takes to locally run tests before
submitting a pull request.</p>
<p>For more, see the <a class="reference external" href="https://docs.pytest.org/en/latest/">pytest</a> documentation.</p>
</section>
<section id="documenting-change-log">
<h2><a class="toc-backref" href="#id12">Documenting change log</a><a class="headerlink" href="#documenting-change-log" title="Permalink to this headline">¶</a></h2>
<p>Changes should be reflected in the release notes located in <code class="docutils literal notranslate"><span class="pre">CHANGELOG.md</span></code> in the root directory of the spectrochempy package.
This file contains an ongoing change log for each release.  Add an entry to this file to
document your fix, enhancement or (unavoidable) breaking change.  Include the
GitHub issue number when adding your entry (using <code class="docutils literal notranslate"><span class="pre">(issue</span> <span class="pre">#1234)`</span></code> where <code class="docutils literal notranslate"><span class="pre">1234</span></code> is the
issue/pull request number).</p>
</section>
</section>


           </div>
          </div>

          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="contributing.html" class="btn btn-neutral float-left" title="Contributing to SpectroChemPy" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="contributing_codespecifics.html" class="btn btn-neutral float-right" title="Contributing to specific parts of the code" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2014-2022 - A.Travert &amp; C.Fernandez @ LCS.
      <span class="lastupdated">Last updated on May 16, 2022.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>