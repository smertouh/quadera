<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fitting &mdash; SpectroChemPy v0.2.23 0.2.23 documentation</title><link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/theme_override.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/gallery-dataframe.css" type="text/css" /><link rel="shortcut icon" href="../../_static/scpy.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Units &amp; Quantities" href="../units/units.html" />
    <link rel="prev" title="MCR ALS" href="../analysis/mcr_als.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html"><img src="../../_static/scpy.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.2.23
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">

    <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
      <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> SpectroChemPy </span>
        version: stable
        <span class="fa fa-caret-down"></span>
      </span>
        <div class="rst-other-versions">
            <dl>
                <dt>Other versions</dt>
                
                    
                        <dd><a href="https://www.spectrochempy.fr/latest/index.html"">LATEST</a></dd>
                    
                
                    
                
            </dl>
            <hr/>
            <dl>
                <dt>Downloads</dt>
                <!-- PDF docs are not built anymore
                <dd><a href="https://www.spectrochempy.fr/downloads/stable-spectrochempy.pdf">PDF</a></dd> -->
                <dd><a href="https://www.spectrochempy.fr/downloads/stable-spectrochempy-notebooks.zip"
                        title="All Jupyter Notebooks used in this documentation" >Notebooks</a></dd>
                <dd><a href="https://www.spectrochempy.fr/downloads/set_colab.sh"
                       title="Colaboratory installation script" >set_colab.sh</a></dd>
                <dd><a href="https://www.spectrochempy.fr/downloads/requirements.txt"
                       title="pip requirements file" >requirements.txt</a></dd>

            </dl>
            <hr/>
            <dl>
                <dt>Sources on GitHub</dt>
                <dd><a href="https://github.com/spectrochempy/spectrochempy/releases/latest">Stable</a></dd>
                <dd><a href="https://github.com/spectrochempy/spectrochempy/tree/master/">Latest</a></dd>

            </dl>

        </div>
    </div>

    
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/whyscpy.html">Why <strong>SpectroChemPy</strong>  ?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/gallery/auto_examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/install/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/papers.html">Papers citing <strong>SpectroChemPy</strong></a></li>
</ul>
<p class="caption"><span class="caption-text">User's Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../objects.html">Data structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../importexport/importexport.html">Import &amp; Export</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plotting/plotting.html">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../processing/processing.html">Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis/analysis.html">Analysis</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Fitting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Solving-a-linear-equation-using-the-least-square-method-(LSTSQ)">Solving a linear equation using the least square method (LSTSQ)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Least-square-with-non-negativity-constraint-(NNLS)">Least square with non-negativity constraint (NNLS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#NDDataset-modelling-using-the-Fit-method">NDDataset modelling using the Fit method</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../units/units.html">Units &amp; Quantities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../databases/databases.html">Databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/api.html">API Configuration</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference &amp; Help</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/changelog.html">What’s new</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Public API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/faq.html">Frequently asked questions (FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devguide/issues.html">Bug reports &amp; feature request</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devguide/examples.html">Sharing examples &amp; tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devguide/index.html">Developer’s Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Credits</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../credits/credits.html">Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../credits/citing.html">Citing  <strong>SpectroChemPy</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../credits/license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../credits/seealso.html">See also</a></li>
</ul>



        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">SpectroChemPy v0.2.23</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Fitting</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/userguide/fitting/fitting.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
    
    
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Fitting">
<h1>Fitting<a class="headerlink" href="#Fitting" title="Permalink to this headline">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">spectrochempy</span> <span class="k">as</span> <span class="nn">scp</span>
<span class="kn">from</span> <span class="nn">spectrochempy</span> <span class="kn">import</span> <span class="n">ur</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table><tr><td>

<img src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAAlw
SFlzAAAJOgAACToB8GSSSgAAAetpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6
bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8x
OTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAg
eG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMu
YWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx4bXA6Q3JlYXRvclRvb2w+bWF0cGxvdGxpYiB2ZXJzaW9uIDIuMS4wLCBo
dHRwOi8vbWF0cGxvdGxpYi5vcmcvPC94bXA6Q3JlYXRvclRvb2w+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6
T3JpZW50YXRpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgqNQaNYAAAGiUlE
QVRIDY1We4xU1Rn/3XPuYx47u8w+hnU38hTcuoUEt/6D2y4RB0ME1BoEd9taJaKh9CFiN7YGp7appUAMNmktMZFoJTYVLVQ0smsy
26CN0SU1QgsuFAaW3WVmx33N677O6XfuyoIxTXqSO/fec+75fd93vt/3/UbDV0aKSZmCpkFMLz3T9utuu2N+o98aDSMBKVAo89z5
y+zEz3ZafcCOfvWdlGCalqKn1Bf71CygTd+mf1esSOnpdMpTb+vWpTZuWVfe3jLPa5tzHYNm0T5N0gpdkkHaDBeGBU6d1/t/fyS8
+/CbqdfUvmsx1PuMgc2bNxv79u1zgd31r+7JH1jbIZKxWRXAcYUQ8IWvBfBXNjEuJWPgMA02NR7C3/pYT9fjdZ3A9tGrWF8YSJHn
qcDz3y7q2T967PZv+gnYJdd1mEZ+62zGDQV/dQgKhmLzDNOXCEWM3j6eTT5Y3w78dOBKJLR1PQf+4ivPj76UPZnssBN+wbM9Aet/
AV81Mf1EEULXYfOobvX2WWQk0aoioXwwSmirOlioY0mu8BIouzYl7P8GV3vpqCCEZvlFz769w08oLDWvyKIyL1asSm28d6WfzA97
ztvvV1kexUMsmhlkULEkuGYmFYC6AvfUrITnwUKl5K79lkjeSSRRTCTbQPd95e1WzMbZSya74XoXAxctCllCnbECMOjZNGRwvzIX
nD85wbkMmKK+U045Dtdi8Qp+SAxU2GTg2bYlC9224pgvmSb54vkVTBQYyhUt2KjAMyMmPjwRQW5Mh2WKwJhlBh6jVGagFM84wZnQ
4bpC0Rt4pk1PbSt0NDcxDA5xryosDHWgtbM0DGZDWLSoiDMDYeQnGVrmOThxLozB0RAaahzkJzjKNqcIQBymJFMkOlN8Dqjpg0XY
Tx5xO/QbmmUrqIjGJznq47TqTaClKYfjp+PInLMwnOdYvtQBZ2XcunQY+VwIo4U4muoFEjVEFE6lQyEUKzHYfgQG9ylCyngU+Cxj
tOqxCDGHcCsOMCs6iQul5ZiStdATYxjMZXDLTUVwLY8Jey4uOh2IxjwsrP8UXJYxUrkZrghBahzV5iXU6gNkq0Z1EzIsUBUSCV2n
EOHo0LVxHCpuxabJJdhi5PFnvw5vLXwXIfNZvD/+JNo/X40NegE54sUaazl+UL8XD1x+FB9Ijjt4EQfdGN6J/x131LwIV9ap/AYs
0x1fz1ZKFbh6A7qKy/By9Dg6G36Ep91vUJJ15Cqr0Z67E8/HzmBrw1OwxWyM+3Mo6BAuSB17oyfx0Oyl2DN0Hqs/70Cx6hBCvESF
UY1ShWXZZEE7OTAYxZzaPH4TuoiusZvRnunFy2NbiHYuBp2vB66srX4vMEjpRKPxKXmnoQ4+Mn4DPiv8CYcrs3GfNUXJLtM+alSO
hrMj/KT+wBNW3+E/2liywNO3iSflbaFva/+stGDTxE0E9Sjaox8HBhxpEamzMGSEaFKg+mjEddzDh1MxTDq3YV1kGBsjfwW3S9Cq
anjmko+ndlb1UR3s6K8JlfphNWq9Ew/7c61T2BB/EbcaNkb8GBaE0tANH7/M34PLdhJDzjIcL9xPbdTG6zyM72Y+wXPHmvB489No
fm0b5HnbQ9Rgp/7DSSd29AeVvPeNyK6JcYl/yQVi5dBjuGvoV/gaJe47s45QUxrDmcYX0MBsdF7egvXZ7+O0vZA4X8QmOQWjlSK7
RDz5wIM30gp9UbWcGjXxhzdDu1SiNSpx6kcQB57rPnr/3dlkZarWLnlRq5oPET1dOCIOk4wALib9eeS5iygfhkd09H0DWphB/+gs
+PcOAS+ssrFmmXXgVfR0de9cpbAJfH3Q1jofW9DZk56dDcVsq9YcsoUMEd1qyLoT3BX1YiyHMJuk97hyjqIoE91t+NcTLeN0ZrfM
oXatZbu6G0h4VG+ibqq0IJVK6cAjo6serG3vSUezCMct0yQeSOFJSUImqb2qbknUpDqlZxE0QZ+ZUpSlZx79h4Nda6zef9dlk121
JDjbR5XggPRZlRnS6bRQRtLpn4++cuie/Yvn2svmNxuLw9WCcYIl4fEoTEGiSTUqJdfgU+8ROqf1iMkLzS389YtNPXc/PH8l8ONB
JZkHD+4JtD04HmVEDWWErmBhzV2/2LB1bemJG6krzv2S6NOHUgtEP0Oif5pE/3fHoruP7N8RiP61GArzSwbUhJJQpXJKiKbfr/3b
IhKq76sKPUdF9NW/LSqfSn6vjv8C45H/6FSgvZQAAAAASUVORK5CYII='
     style='height:25px; border-radius:12px; display:inline-block; float:left; vertical-align:middle'></img>

</td><td>

&nbsp;&nbsp;<span style='font-size:12px'>SpectroChemPy's API - v.0.2.23<br/>© Copyright 2014-2022 - A.Travert & C.Fernandez @ LCS</span>

</td></tr></table>
</div></div>
</div>
<div class="section" id="Solving-a-linear-equation-using-the-least-square-method-(LSTSQ)">
<h2>Solving a linear equation using the least square method (LSTSQ)<a class="headerlink" href="#Solving-a-linear-equation-using-the-least-square-method-(LSTSQ)" title="Permalink to this headline">¶</a></h2>
<p>In the first example, we find the least square solution of a simple linear equation.</p>
<p>Let’s first create a NDDataset with some data. We have for instance some noisy data that represent the distance <code class="docutils literal notranslate"><span class="pre">d</span></code> traveled by some objects versus time <code class="docutils literal notranslate"><span class="pre">t</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">var</span>
    <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">return</span> <span class="n">d</span>


<span class="n">time</span> <span class="o">=</span> <span class="n">scp</span><span class="o">.</span><span class="n">LinearCoord</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;hour&quot;</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">scp</span><span class="o">.</span><span class="n">NDDataset</span><span class="o">.</span><span class="n">fromfunction</span><span class="p">(</span>
    <span class="n">func</span><span class="p">,</span>
    <span class="n">v</span><span class="o">=</span><span class="mf">100.0</span> <span class="o">*</span> <span class="n">ur</span><span class="p">(</span><span class="s2">&quot;km/hr&quot;</span><span class="p">),</span>
    <span class="n">var</span><span class="o">=</span><span class="mf">60.0</span> <span class="o">*</span> <span class="n">ur</span><span class="p">(</span><span class="s2">&quot;km&quot;</span><span class="p">),</span>
    <span class="c1"># extra arguments passed to the function v, var</span>
    <span class="n">coordset</span><span class="o">=</span><span class="n">scp</span><span class="o">.</span><span class="n">CoordSet</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">time</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;mydataset&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;distance travelled&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Here is a plot of these data-points:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">prefs</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">preferences</span>
<span class="n">prefs</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">plot_scatter</span><span class="p">(</span><span class="n">markersize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;_AxesSubplot:xlabel=&#39;time $\\mathrm{/\\ \\mathrm{hr}}$&#39;, ylabel=&#39;distance travelled $\\mathrm{/\\ \\mathrm{km}}$&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/userguide_fitting_fitting_5_1.png" src="../../_images/userguide_fitting_fitting_5_1.png" />
</div>
</div>
<p>We want to fit a line through these data-points of equation</p>
<p><span class="math notranslate nohighlight">\(d = v.t + d_0\)</span></p>
<p>By construction, we know already that the line should have a gradient of roughly 100 km/h and cut the y-axis at, more or less, 0 km.</p>
<p>Using LSTSQ, the solution is found very easily:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lst</span> <span class="o">=</span> <span class="n">scp</span><span class="o">.</span><span class="n">LSTSQ</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>

<span class="n">v</span><span class="p">,</span> <span class="n">d0</span> <span class="o">=</span> <span class="n">lst</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;speed : {:.3fK},  distance at time 0 : {:.3fK}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">d0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
speed : 98.928 km.hr^-1,  distance at time 0 : 2.699 km
</pre></div></div>
</div>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle">Note</p>
<p>In the particular case where the variation is proportional to the x dataset coordinate, the same result can be obtained directly using <code class="docutils literal notranslate"><span class="pre">d</span></code> as a single parameter on LSTSQ (as <code class="docutils literal notranslate"><span class="pre">t</span></code> is the <code class="docutils literal notranslate"><span class="pre">x</span></code> coordinate axis!)</p>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lst</span> <span class="o">=</span> <span class="n">scp</span><span class="o">.</span><span class="n">LSTSQ</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

<span class="n">v</span><span class="p">,</span> <span class="n">d0</span> <span class="o">=</span> <span class="n">lst</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;speed : {:.3fK},  distance at time 0 : {:.3fK}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">d0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
speed : 98.928 km.hr^-1,  distance at time 0 : 2.699 km
</pre></div></div>
</div>
<p>and the final plot</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">d</span><span class="o">.</span><span class="n">plot_scatter</span><span class="p">(</span>
    <span class="n">markersize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
    <span class="n">mfc</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
    <span class="n">mec</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original data&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Least-square fitting &quot;</span> <span class="s2">&quot;example&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">dfit</span> <span class="o">=</span> <span class="n">lst</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">()</span>

<span class="n">dfit</span><span class="o">.</span><span class="n">plot_pen</span><span class="p">(</span><span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot; Fitted line&quot;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;_AxesSubplot:title={&#39;center&#39;:&#39;Least-square fitting example&#39;}, xlabel=&#39;time $\\mathrm{/\\ \\mathrm{hr}}$&#39;, ylabel=&#39;distance travelled $\\mathrm{/\\ \\mathrm{km}}$&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/userguide_fitting_fitting_11_1.png" src="../../_images/userguide_fitting_fitting_11_1.png" />
</div>
</div>
<p>Let’s try now with a quadratic increase of the speed:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="o">-</span> <span class="mf">0.8</span><span class="p">)</span> <span class="o">*</span> <span class="n">var</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="o">*</span> <span class="n">d</span><span class="o">.</span><span class="n">units</span>
    <span class="k">return</span> <span class="n">d</span>


<span class="n">time</span> <span class="o">=</span> <span class="n">scp</span><span class="o">.</span><span class="n">Coord</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;hour&quot;</span><span class="p">)</span>
<span class="n">d2</span> <span class="o">=</span> <span class="n">scp</span><span class="o">.</span><span class="n">NDDataset</span><span class="o">.</span><span class="n">fromfunction</span><span class="p">(</span>
    <span class="n">func</span><span class="p">,</span>
    <span class="n">a</span><span class="o">=</span><span class="mf">100.0</span> <span class="o">*</span> <span class="n">ur</span><span class="p">(</span><span class="s2">&quot;km/hr^2&quot;</span><span class="p">),</span>
    <span class="n">var</span><span class="o">=</span><span class="mf">60.0</span> <span class="o">*</span> <span class="n">ur</span><span class="p">(</span><span class="s2">&quot;km&quot;</span><span class="p">),</span>
    <span class="c1"># extra arguments passed to the function v, var</span>
    <span class="n">coordset</span><span class="o">=</span><span class="n">scp</span><span class="o">.</span><span class="n">CoordSet</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">time</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;mydataset&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;distance travelled&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">d2</span><span class="o">.</span><span class="n">plot_scatter</span><span class="p">(</span><span class="n">markersize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;_AxesSubplot:xlabel=&#39;time $\\mathrm{/\\ \\mathrm{hr}}$&#39;, ylabel=&#39;distance travelled $\\mathrm{/\\ \\mathrm{km}}$&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/userguide_fitting_fitting_13_1.png" src="../../_images/userguide_fitting_fitting_13_1.png" />
</div>
</div>
<p>Now we must use the first syntax LSTQ(X, Y) as the variation is not proportional to time, but to its square.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X</span> <span class="o">=</span> <span class="n">time</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">lst</span> <span class="o">=</span> <span class="n">scp</span><span class="o">.</span><span class="n">LSTSQ</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">d2</span><span class="p">)</span>

<span class="n">v</span><span class="p">,</span> <span class="n">d0</span> <span class="o">=</span> <span class="n">lst</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;acceleration : {:.3fK},  distance at time 0 : {:.3fK}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">d0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
acceleration : 11.042 km.hr^-2,  distance at time 0 : -12.047 km
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">d2</span><span class="o">.</span><span class="n">plot_scatter</span><span class="p">(</span>
    <span class="n">markersize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
    <span class="n">mfc</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
    <span class="n">mec</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original data&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Least-square fitting &quot;</span> <span class="s2">&quot;example on quadratic data&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">dfit</span> <span class="o">=</span> <span class="n">lst</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">()</span>

<span class="n">dfit</span><span class="o">.</span><span class="n">plot_pen</span><span class="p">(</span><span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot; Fitted line&quot;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;_AxesSubplot:title={&#39;center&#39;:&#39;Least-square fitting example on quadratic data&#39;}, xlabel=&#39;time $\\mathrm{/\\ \\mathrm{hr}}$&#39;, ylabel=&#39;distance travelled $\\mathrm{/\\ \\mathrm{km}}$&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/userguide_fitting_fitting_16_1.png" src="../../_images/userguide_fitting_fitting_16_1.png" />
</div>
</div>
</div>
<div class="section" id="Least-square-with-non-negativity-constraint-(NNLS)">
<h2>Least square with non-negativity constraint (NNLS)<a class="headerlink" href="#Least-square-with-non-negativity-constraint-(NNLS)" title="Permalink to this headline">¶</a></h2>
<p>When fitting data with LSTSQ, it happens that we get some negative values were it should not, for instance having a negative distance at time 0.</p>
<p>In this case, we can use the NNLS method of fitting. It operates as <code class="docutils literal notranslate"><span class="pre">LSTSQ</span></code> but keep the Y values always positive.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X</span> <span class="o">=</span> <span class="n">time</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">lst</span> <span class="o">=</span> <span class="n">scp</span><span class="o">.</span><span class="n">NNLS</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">d2</span><span class="p">)</span>

<span class="n">v</span><span class="p">,</span> <span class="n">d0</span> <span class="o">=</span> <span class="n">lst</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;acceleration : {:.3fK},  distance at time 0 : {:.3fK}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">d0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
acceleration : 10.851 km.hr^-2,  distance at time 0 : 0.000 km
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">d2</span><span class="o">.</span><span class="n">plot_scatter</span><span class="p">(</span>
    <span class="n">markersize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
    <span class="n">mfc</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
    <span class="n">mec</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original data&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Non-negative Least-square fitting &quot;</span> <span class="s2">&quot;example&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">dfit</span> <span class="o">=</span> <span class="n">lst</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">()</span>

<span class="n">dfit</span><span class="o">.</span><span class="n">plot_pen</span><span class="p">(</span><span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot; Fitted line&quot;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;_AxesSubplot:title={&#39;center&#39;:&#39;Non-negative Least-square fitting example&#39;}, xlabel=&#39;time $\\mathrm{/\\ \\mathrm{hr}}$&#39;, ylabel=&#39;distance travelled $\\mathrm{/\\ \\mathrm{km}}$&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/userguide_fitting_fitting_20_1.png" src="../../_images/userguide_fitting_fitting_20_1.png" />
</div>
</div>
</div>
<div class="section" id="NDDataset-modelling-using-the-Fit-method">
<h2>NDDataset modelling using the Fit method<a class="headerlink" href="#NDDataset-modelling-using-the-Fit-method" title="Permalink to this headline">¶</a></h2>
<p>First we will load an IR dataset</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">nd</span> <span class="o">=</span> <span class="n">scp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;irdata/nh4y-activation.spg&quot;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>As we want to start with a single 1D spectra, we select the last one (index -1)</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">nd</span> <span class="o">=</span> <span class="n">nd</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<span class="c1"># nd[-1] returns a nddataset with shape (1,5549)</span>
<span class="c1"># this is why we squeeze it to get a pure 1D dataset with shape (5549,)</span>
</pre></div>
</div>
</div>
<p>Now we slice it to keep only the OH vibration region:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ndOH</span> <span class="o">=</span> <span class="n">nd</span><span class="p">[</span><span class="mf">3700.0</span><span class="p">:</span><span class="mf">3300.0</span><span class="p">]</span>
<span class="n">ndOH</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;_AxesSubplot:xlabel=&#39;wavenumbers $\\mathrm{/\\ \\mathrm{cm}^{-1}}$&#39;, ylabel=&#39;absorbance $\\mathrm{/\\ \\mathrm{a.u.}}$&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/userguide_fitting_fitting_27_1.png" src="../../_images/userguide_fitting_fitting_27_1.png" />
</div>
</div>
<div class="section" id="Baseline-correction">
<h3>Baseline correction<a class="headerlink" href="#Baseline-correction" title="Permalink to this headline">¶</a></h3>
<p>We can perform a linear baseline correction to start with this data (see the <a class="reference internal" href="../processing/baseline.html"><span class="doc">baseline tutorial</span></a>). For removing a linear baseline, the fastest method is however to use the <code class="docutils literal notranslate"><span class="pre">abc</span></code> ( automatic baseline correction)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ndOHcorr</span> <span class="o">=</span> <span class="n">scp</span><span class="o">.</span><span class="n">abc</span><span class="p">(</span><span class="n">ndOH</span><span class="p">)</span>
<span class="n">ndOHcorr</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;_AxesSubplot:xlabel=&#39;wavenumbers $\\mathrm{/\\ \\mathrm{cm}^{-1}}$&#39;, ylabel=&#39;absorbance $\\mathrm{/\\ \\mathrm{a.u.}}$&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/userguide_fitting_fitting_30_1.png" src="../../_images/userguide_fitting_fitting_30_1.png" />
</div>
</div>
</div>
<div class="section" id="Peak-finding">
<h3>Peak finding<a class="headerlink" href="#Peak-finding" title="Permalink to this headline">¶</a></h3>
<p>Below we will need to start with some guess of the peak position and width. For this we can use the <code class="docutils literal notranslate"><span class="pre">find_peaks()</span></code> method (see <a class="reference internal" href="../analysis/peak_finding.html"><span class="doc">Peak finding tutorial</span></a>)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ndOHcorr</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">()</span>
<span class="n">peaks</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table><tbody><tr><th>Magnitude</th><td style='text-align:left;'><pre>[3693.72696012532 3678.369851598123 3624.858834093695 3541.3318339222733]</pre></td></tr><tr><th>Units</th><td style='text-align:left;'>cm<sup>-1</sup></td></tr></tbody></table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">ndOHcorr</span><span class="o">.</span><span class="n">plot_pen</span><span class="p">()</span>  <span class="c1"># output the spectrum on ax. ax will receive next plot too</span>
<span class="n">pks</span> <span class="o">=</span> <span class="n">peaks</span> <span class="o">+</span> <span class="mf">0.01</span>  <span class="c1"># add a small offset on the y position of the markers</span>
<span class="n">pks</span><span class="o">.</span><span class="n">plot_scatter</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;v&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
    <span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># we need to keep the previous output on ax</span>
    <span class="n">data_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># we dont need to redraw all things like labels, etc...</span>
    <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;_AxesSubplot:xlabel=&#39;wavenumbers $\\mathrm{/\\ \\mathrm{cm}^{-1}}$&#39;, ylabel=&#39;absorbance $\\mathrm{/\\ \\mathrm{a.u.}}$&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/userguide_fitting_fitting_33_1.png" src="../../_images/userguide_fitting_fitting_33_1.png" />
</div>
</div>
<p>The maximum of the two major peaks are thus exactly at 3624.61 and 3541.68 cm<span class="math notranslate nohighlight">\(^{-1}\)</span></p>
</div>
<div class="section" id="Fitting-script">
<h3>Fitting script<a class="headerlink" href="#Fitting-script" title="Permalink to this headline">¶</a></h3>
<p>Now we will define the fitting procedure as a script</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">script</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>

<span class="s2">#-----------------------------------------------------------</span>
<span class="s2"># syntax for parameters definition :</span>
<span class="s2"># name : value, low_bound,  high_bound</span>
<span class="s2">#  * for fixed parameters</span>
<span class="s2">#  $ for variable parameters</span>
<span class="s2">#  &gt; for reference to a parameter in the COMMON block</span>
<span class="s2">#    (&gt; is forbidden in the COMMON block)</span>
<span class="s2"># common block parameters should not have a _ in their names</span>
<span class="s2">#-----------------------------------------------------------</span>
<span class="s2">#</span>
<span class="s2">COMMON:</span>
<span class="s2"># common parameters ex.</span>
<span class="s2"># $ gwidth: 1.0, 0.0, none</span>
<span class="s2">$ gratio: 0.1, 0.0, 1.0</span>
<span class="s2">$ gassym: 0.1, 0, 1</span>

<span class="s2">MODEL: LINE_1</span>
<span class="s2">shape: assymvoigtmodel</span>
<span class="s2">    * ampl:  1.0, 0.0, none</span>
<span class="s2">    $ pos:   3624.61, 3520.0, 3570.0</span>
<span class="s2">    &gt; ratio: gratio</span>
<span class="s2">    &gt; assym: gassym</span>
<span class="s2">    $ width: 200, 0, 1000</span>

<span class="s2">MODEL: LINE_2</span>
<span class="s2">shape: assymvoigtmodel</span>
<span class="s2">    $ ampl:  0.2, 0.0, none</span>
<span class="s2">    $ pos:   3541.68, 3400.0, 3700.0</span>
<span class="s2">    &gt; ratio: gratio</span>
<span class="s2">    &gt; assym: gassym</span>
<span class="s2">    $ width: 200, 0, 1000</span>

<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="Syntax-for-parameters-definition">
<h4>Syntax for parameters definition<a class="headerlink" href="#Syntax-for-parameters-definition" title="Permalink to this headline">¶</a></h4>
<p>In such script, the char <code class="docutils literal notranslate"><span class="pre">#</span></code> at the beginning of a line denote that the whole line is a comment. Comments are obviously optional but may be useful to explain</p>
<p>Each individual model component is identified by the keyword <code class="docutils literal notranslate"><span class="pre">MODEL</span></code></p>
<p>A <code class="docutils literal notranslate"><span class="pre">MODEL</span></code> have a name, <em>e.g.</em>, <code class="docutils literal notranslate"><span class="pre">MODEL:</span> <span class="pre">LINE_1</span></code>.</p>
<p>Then come for each model components its <code class="docutils literal notranslate"><span class="pre">shape</span></code>, <em>i.e.,</em> the shape of the line.</p>
<p>Come after the definition of the model parameters depending on the shape, e.g., for a <code class="docutils literal notranslate"><span class="pre">gaussianmodel</span></code> we have three parameters: <code class="docutils literal notranslate"><span class="pre">amplitude</span></code> (<code class="docutils literal notranslate"><span class="pre">ampl</span></code>), <code class="docutils literal notranslate"><span class="pre">width</span></code> and <code class="docutils literal notranslate"><span class="pre">position</span></code> (<code class="docutils literal notranslate"><span class="pre">pos</span></code>) of the line.</p>
<p>To define a given parameter, we have to write its <code class="docutils literal notranslate"><span class="pre">name</span></code> and a set of 3 values: the expected <code class="docutils literal notranslate"><span class="pre">value</span></code> and 2 limits for the allowed variations : <code class="docutils literal notranslate"><span class="pre">low_bound</span></code>, <code class="docutils literal notranslate"><span class="pre">high_bound</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="p">:</span> <span class="n">value</span><span class="p">,</span> <span class="n">low_bound</span><span class="p">,</span>  <span class="n">high_bound</span>
</pre></div>
</div>
<p>These parameters are preceded by a mark saying what kind of parameter it will behave in the fit procedure:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$</span></code> is the default and denote a variable parameters</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*</span></code> denotes fixed parameters</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&gt;</span></code> say that the given parameters is actually defined in a COMMON block</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">COMMON</span></code>is the common block containing parameters to which a parameter in the MODEL blocks can make reference using the <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> markers. (<code class="docutils literal notranslate"><span class="pre">&gt;</span></code> obviously is forbidden in the COMMON block) common block parameters should not have a <code class="docutils literal notranslate"><span class="pre">_</span></code>(underscore) in their names</p>
<p>With this parameter script definition, you can thus make rather complex search for modelling, as you can make parameters dependents or fixed.</p>
<p>The line shape can be (up to now) in the following list of shape (for 1D models - see below for 2D):</p>
<ul>
<li><p>PolynomialBaseline -&gt; <code class="docutils literal notranslate"><span class="pre">polynomialbaseline</span></code>:</p>
<p>Arbitrary-degree polynomial (degree limited to 10, however). As a linear baseline is automatically calculated during fitting, this polynom is always of greater or equal to order 2 (parabolic function at the minimum).</p>
<p><span class="math notranslate nohighlight">\(f(x) = ampl * \sum_{i=2}^{max} c_i*x^i\)</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>MODEL: baseline
shape: polynomialbaseline
# This polynomial starts at the order 2
$ ampl: val, 0.0, None
$ c_2: 1.0, None, None
* c_3: 0.0, None, None
* c_4: 0.0, None, None
# etc
</pre></div>
</div>
</li>
<li><p>Gaussian Model -&gt; <code class="docutils literal notranslate"><span class="pre">gaussianmodel</span></code>:</p>
<p>Normalized 1D gaussian function.</p>
<p><span class="math notranslate nohighlight">\(f(x) = \frac{ampl}{\sqrt{2 \pi \sigma^2}} \exp({\frac{-(x-pos)^2}{2 \sigma^2}})\)</span></p>
<p>where <span class="math notranslate nohighlight">\(\sigma = \frac{width}{2.3548}\)</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>MODEL: Linex
shape: gaussianmodel
$ ampl: val, 0.0, None
$ width: val, 0.0, None
$ pos: val, lob,  upb
</pre></div>
</div>
</li>
<li><p>Lorentzian Model -&gt; <code class="docutils literal notranslate"><span class="pre">lorentzianmodel</span></code>:</p>
<p>A standard Lorentzian function (also known as the Cauchy distribution).</p>
<p><span class="math notranslate nohighlight">\(f(x) = \frac{ampl * \lambda}{\pi [(x-pos)^2+ \lambda^2]}\)</span></p>
<p>where <span class="math notranslate nohighlight">\(\lambda = \frac{width}{2}\)</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>MODEL: liney:
shape: lorentzianmodel
$ ampl:val, 0.0, None
$ width: val, 0.0, None
$ pos: val, lob, upb
</pre></div>
</div>
</li>
<li><p>Voigt Model -&gt; <code class="docutils literal notranslate"><span class="pre">voigtmodel</span></code>:</p>
<p>A Voigt model constructed as the convolution of a <code class="docutils literal notranslate"><span class="pre">GaussianModel</span></code> and a <code class="docutils literal notranslate"><span class="pre">LorentzianModel</span></code> – commonly used for spectral line fitting.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>MODEL: linez
shape: voigtmodel
$ ampl: val, 0.0, None
$ width: val, 0.0, None
$ pos: val, lob, upb
$ ratio: val, 0.0, 1.0
</pre></div>
</div>
</li>
<li><p>Assymetric Voigt Model -&gt; <code class="docutils literal notranslate"><span class="pre">assymvoigtmodel</span></code>:</p>
<p>An assymetric Voigt model (A. L. Stancik and E. B. Brauns, Vibrational Spectroscopy, 2008, 47, 66-69)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>MODEL: linez
shape: voigtmodel
$ ampl: val, 0.0, None
$ width: val, 0.0, None
$ pos: val, lob, upb
$ ratio: val, 0.0, 1.0
$ assym: val, 0.0, 1.0
</pre></div>
</div>
</li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">f1</span> <span class="o">=</span> <span class="n">scp</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">ndOHcorr</span><span class="p">,</span> <span class="n">script</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">f1</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">maxiter</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">every</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ndOHcorr</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">plot_model</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Iterations: 1800, Calls: 2744 (chi2: 424.32659)
The number of experiment(s) is set to 1

**************************************************
Result:
**************************************************
#PARAMETER SCRIPT

COMMON:
        $ gratio:     0.7157, 0.0, 1.0
        $ gassym:     0.0413, 0, 1

MODEL: line_1
shape: assymvoigtmodel
        * ampl:     1.0000, 0.0, none
        &gt; assym:gassym
        $ pos:  3569.9506, 3520.0, 3570.0
        &gt; ratio:gratio
        $ width:   843.0627, 0, 1000

MODEL: line_2
shape: assymvoigtmodel
        $ ampl:     0.7569, 0.0, none
        &gt; assym:gassym
        $ pos:  3494.9913, 3400.0, 3700.0
        &gt; ratio:gratio
        $ width:   566.7749, 0, 1000
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;_AxesSubplot:xlabel=&#39;wavenumbers $\\mathrm{/\\ \\mathrm{cm}^{-1}}$&#39;, ylabel=&#39;absorbance $\\mathrm{/\\ \\mathrm{a.u.}}$&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/userguide_fitting_fitting_38_2.png" src="../../_images/userguide_fitting_fitting_38_2.png" />
</div>
</div>
<div class="admonition warning">
<p class="admonition-title fa fa-exclamation-circle">Todo</p>
<p>Tutorial to be continued with other methods of optimization and fitting (2D…)</p>
</div>
<script type="application/vnd.jupyter.widget-state+json">
{"state": {}, "version_major": 2, "version_minor": 0}
</script></div>
</div>
</div>
</div>


           </div>
          </div>

          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../analysis/mcr_als.html" class="btn btn-neutral float-left" title="MCR ALS" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../units/units.html" class="btn btn-neutral float-right" title="Units &amp; Quantities" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2014-2022 - A.Travert &amp; C.Fernandez @ LCS.
      <span class="lastupdated">Last updated on Jan 16, 2022.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>