<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Peak Maxima Finding &mdash; SpectroChemPy v0.4.8.dev4 0.4.8.dev4 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/theme_override.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-rendered-html.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/scpy.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Peak integration" href="peak_integration.html" />
    <link rel="prev" title="Analysis" href="analysis.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html">
            <img src="../../_static/scpy.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.4.8.dev4
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">

    <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
      <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> SpectroChemPy </span>
        version: latest
        <span class="fa fa-caret-down"></span>
      </span>
        <div class="rst-other-versions">
            <dl>
                <dt>Other versions</dt>
                
                    
                
                    
                        <dd><a href="https://www.spectrochempy.fr/stable/index.html">STABLE</a></dd>
                    
                
            </dl>
            <hr/>
            <dl>
                <dt>Sources on GitHub</dt>
                <dd><a href="https://github.com/spectrochempy/spectrochempy/releases/latest">Stable</a></dd>
                <dd><a href="https://github.com/spectrochempy/spectrochempy/tree/master/">Latest</a></dd>

            </dl>

        </div>
    </div>

    
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/whyscpy.html">Why <strong>SpectroChemPy</strong>  ?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/gallery/auto_examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/install/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/papers.html">Papers citing <strong>SpectroChemPy</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User's Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../objects.html">Data structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../importexport/importexport.html">Import &amp; Export</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plotting/plotting.html">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../processing/processing.html">Processing</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="analysis.html">Analysis</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Peak Maxima Finding</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Loading-an-experimental-dataset">Loading an experimental dataset</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Find-maxima-by-manual-inspection-of-the-plot">Find maxima by manual inspection of the plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Find-maxima-with-an-automated-method:-find_peaks()">Find maxima with an automated method: <code class="docutils literal notranslate"><span class="pre">find_peaks()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="peak_integration.html">Peak integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="fitting.html">Fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="mcr_als.html">MCR ALS</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../units/units.html">Units &amp; Quantities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../databases/databases.html">Databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/api.html">API Configuration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference &amp; Help</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/changelog.html">What’s new</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Public API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/faq.html">Frequently asked questions (FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devguide/issues.html">Bug reports &amp; feature request</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devguide/examples.html">Sharing examples &amp; tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devguide/index.html">Developer’s Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Credits</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../credits/credits.html">Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../credits/credits.html#third-party-licences">Third-party Licences</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../credits/citing.html">Citing  <strong>SpectroChemPy</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../credits/license.html">SpectroChempy License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../credits/license.html#other-licenses">Other Licenses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../credits/seealso.html">See also</a></li>
</ul>



        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">SpectroChemPy v0.4.8.dev4</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="analysis.html">Analysis</a> &raquo;</li>
      <li>Peak Maxima Finding</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/userguide/analysis/peak_finding.pct.py" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
    
        <div class="admonition warning">
            <p class="first admonition-title">Note</p>
            <p class="last"> You are reading the documentation related to the development version.
                <a href="https://www.spectrochempy.fr/stable/index.html">Go here</a> if you are looking for the documentation of the last
                release.
            </p>
        </div>
    
    
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Peak-Maxima-Finding">
<h1>Peak Maxima Finding<a class="headerlink" href="#Peak-Maxima-Finding" title="Permalink to this heading">¶</a></h1>
<p>This tutorial shows how to find peaks and determine peak maxima with spectrochempy. As prerequisite, the user is expected to have read the <a class="reference internal" href="../importexport/import.html"><span class="doc">Import</span></a>, <a class="reference internal" href="../importexport/importIR.html"><span class="doc">Import IR</span></a>, <a class="reference internal" href="../processing/slicing.html"><span class="doc">slicing</span></a> tutorials.</p>
<p>Fist, as usual, we need to load the API.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">spectrochempy</span> <span class="k">as</span> <span class="nn">scp</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<table>
<tr>
<td>

<img src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAAlw
SFlzAAAJOgAACToB8GSSSgAAAetpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6
bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8x
OTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAg
eG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMu
YWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx4bXA6Q3JlYXRvclRvb2w+bWF0cGxvdGxpYiB2ZXJzaW9uIDIuMS4wLCBo
dHRwOi8vbWF0cGxvdGxpYi5vcmcvPC94bXA6Q3JlYXRvclRvb2w+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6
T3JpZW50YXRpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgqNQaNYAAAGiUlE
QVRIDY1We4xU1Rn/3XPuYx47u8w+hnU38hTcuoUEt/6D2y4RB0ME1BoEd9taJaKh9CFiN7YGp7appUAMNmktMZFoJTYVLVQ0smsy
26CN0SU1QgsuFAaW3WVmx33N677O6XfuyoIxTXqSO/fec+75fd93vt/3/UbDV0aKSZmCpkFMLz3T9utuu2N+o98aDSMBKVAo89z5
y+zEz3ZafcCOfvWdlGCalqKn1Bf71CygTd+mf1esSOnpdMpTb+vWpTZuWVfe3jLPa5tzHYNm0T5N0gpdkkHaDBeGBU6d1/t/fyS8
+/CbqdfUvmsx1PuMgc2bNxv79u1zgd31r+7JH1jbIZKxWRXAcYUQ8IWvBfBXNjEuJWPgMA02NR7C3/pYT9fjdZ3A9tGrWF8YSJHn
qcDz3y7q2T967PZv+gnYJdd1mEZ+62zGDQV/dQgKhmLzDNOXCEWM3j6eTT5Y3w78dOBKJLR1PQf+4ivPj76UPZnssBN+wbM9Aet/
AV81Mf1EEULXYfOobvX2WWQk0aoioXwwSmirOlioY0mu8BIouzYl7P8GV3vpqCCEZvlFz769w08oLDWvyKIyL1asSm28d6WfzA97
ztvvV1kexUMsmhlkULEkuGYmFYC6AvfUrITnwUKl5K79lkjeSSRRTCTbQPd95e1WzMbZSya74XoXAxctCllCnbECMOjZNGRwvzIX
nD85wbkMmKK+U045Dtdi8Qp+SAxU2GTg2bYlC9224pgvmSb54vkVTBQYyhUt2KjAMyMmPjwRQW5Mh2WKwJhlBh6jVGagFM84wZnQ
4bpC0Rt4pk1PbSt0NDcxDA5xryosDHWgtbM0DGZDWLSoiDMDYeQnGVrmOThxLozB0RAaahzkJzjKNqcIQBymJFMkOlN8Dqjpg0XY
Tx5xO/QbmmUrqIjGJznq47TqTaClKYfjp+PInLMwnOdYvtQBZ2XcunQY+VwIo4U4muoFEjVEFE6lQyEUKzHYfgQG9ylCyngU+Cxj
tOqxCDGHcCsOMCs6iQul5ZiStdATYxjMZXDLTUVwLY8Jey4uOh2IxjwsrP8UXJYxUrkZrghBahzV5iXU6gNkq0Z1EzIsUBUSCV2n
EOHo0LVxHCpuxabJJdhi5PFnvw5vLXwXIfNZvD/+JNo/X40NegE54sUaazl+UL8XD1x+FB9Ijjt4EQfdGN6J/x131LwIV9ap/AYs
0x1fz1ZKFbh6A7qKy/By9Dg6G36Ep91vUJJ15Cqr0Z67E8/HzmBrw1OwxWyM+3Mo6BAuSB17oyfx0Oyl2DN0Hqs/70Cx6hBCvESF
UY1ShWXZZEE7OTAYxZzaPH4TuoiusZvRnunFy2NbiHYuBp2vB66srX4vMEjpRKPxKXmnoQ4+Mn4DPiv8CYcrs3GfNUXJLtM+alSO
hrMj/KT+wBNW3+E/2liywNO3iSflbaFva/+stGDTxE0E9Sjaox8HBhxpEamzMGSEaFKg+mjEddzDh1MxTDq3YV1kGBsjfwW3S9Cq
anjmko+ndlb1UR3s6K8JlfphNWq9Ew/7c61T2BB/EbcaNkb8GBaE0tANH7/M34PLdhJDzjIcL9xPbdTG6zyM72Y+wXPHmvB489No
fm0b5HnbQ9Rgp/7DSSd29AeVvPeNyK6JcYl/yQVi5dBjuGvoV/gaJe47s45QUxrDmcYX0MBsdF7egvXZ7+O0vZA4X8QmOQWjlSK7
RDz5wIM30gp9UbWcGjXxhzdDu1SiNSpx6kcQB57rPnr/3dlkZarWLnlRq5oPET1dOCIOk4wALib9eeS5iygfhkd09H0DWphB/+gs
+PcOAS+ssrFmmXXgVfR0de9cpbAJfH3Q1jofW9DZk56dDcVsq9YcsoUMEd1qyLoT3BX1YiyHMJuk97hyjqIoE91t+NcTLeN0ZrfM
oXatZbu6G0h4VG+ibqq0IJVK6cAjo6serG3vSUezCMct0yQeSOFJSUImqb2qbknUpDqlZxE0QZ+ZUpSlZx79h4Nda6zef9dlk121
JDjbR5XggPRZlRnS6bRQRtLpn4++cuie/Yvn2svmNxuLw9WCcYIl4fEoTEGiSTUqJdfgU+8ROqf1iMkLzS389YtNPXc/PH8l8ONB
JZkHD+4JtD04HmVEDWWErmBhzV2/2LB1bemJG6krzv2S6NOHUgtEP0Oif5pE/3fHoruP7N8RiP61GArzSwbUhJJQpXJKiKbfr/3b
IhKq76sKPUdF9NW/LSqfSn6vjv8C45H/6FSgvZQAAAAASUVORK5CYII='
     style='height:25px; border-radius:12px; display:inline-block; float:left; vertical-align:middle'>
</img>

</td>
<td>

&nbsp;&nbsp;<span style='font-size:12px'>SpectroChemPy's API - v.0.4.8.dev4<br/>© Copyright 2014-2022 - A.Travert & C.Fernandez @ LCS</span>

</td>
</tr>
</table>
</div></div>
</div>
<section id="Loading-an-experimental-dataset">
<h2>Loading an experimental dataset<a class="headerlink" href="#Loading-an-experimental-dataset" title="Permalink to this heading">¶</a></h2>
<p>A typical IR dataset (CO adsorption on supported CoMo catalyst in the 2300-1900 cm-1 region) will be used throughout.</p>
<p>We load the data using the generic API method <code class="docutils literal notranslate"><span class="pre">read</span></code> (the type of data is inferred from the extension)</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">scp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;irdata/CO@Mo_Al2O3.SPG&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span><span class="o">.</span><span class="n">y</span> <span class="o">-=</span> <span class="n">ds</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># start time a 0 for the  first spectrum</span>
<span class="n">ds</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span>
<span class="n">ds</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;minutes&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Let’s set some preferences for plotting</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prefs</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">preferences</span>
<span class="n">prefs</span><span class="o">.</span><span class="n">method_1D</span> <span class="o">=</span> <span class="s2">&quot;scatter+pen&quot;</span>
<span class="n">prefs</span><span class="o">.</span><span class="n">method_2D</span> <span class="o">=</span> <span class="s2">&quot;stack&quot;</span>
<span class="n">prefs</span><span class="o">.</span><span class="n">colorbar</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">prefs</span><span class="o">.</span><span class="n">colormap</span> <span class="o">=</span> <span class="s2">&quot;Dark2&quot;</span>
</pre></div>
</div>
</div>
<p>We select the desired region and plot it.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reg</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[:,</span> <span class="mf">2300.0</span><span class="p">:</span><span class="mf">1900.0</span><span class="p">]</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/userguide_analysis_peak_finding_11_0.png" src="../../_images/userguide_analysis_peak_finding_11_0.png" />
</div>
</div>
</section>
<section id="Find-maxima-by-manual-inspection-of-the-plot">
<h2>Find maxima by manual inspection of the plot<a class="headerlink" href="#Find-maxima-by-manual-inspection-of-the-plot" title="Permalink to this heading">¶</a></h2>
<p>For instance, after zooming on the highest peak of the last spectrum, one finds that it is located at ~ 2115.5 cm<span class="math notranslate nohighlight">\(^{-1}\)</span>. The exact x-coordinate value can be obtained using the following code (see the <a class="reference internal" href="../processing/slicing.html"><span class="doc">slicing tutorial</span></a> for more info):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pos</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mf">2115.5</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">pos</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
2115.5628130038194 cm<sup>-1</sup></div>
</div>
<p>We can easily get the list of all individual maximas at this position</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maximas</span> <span class="o">=</span> <span class="n">reg</span><span class="p">[:,</span> <span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">maximas</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/userguide_analysis_peak_finding_16_0.png" src="../../_images/userguide_analysis_peak_finding_16_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">maximas</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">~0.2fP</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y</span><span class="si">:</span><span class="s2">~.3fP</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">2115.5</span><span class="p">,</span> <span class="n">maximas</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>
    <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;offset points&quot;</span><span class="p">,</span>
    <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round4,pad=.7&quot;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;0.9&quot;</span><span class="p">),</span>
    <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-&gt;&quot;</span><span class="p">,</span> <span class="n">connectionstyle</span><span class="o">=</span><span class="s2">&quot;angle3&quot;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/userguide_analysis_peak_finding_17_0.png" src="../../_images/userguide_analysis_peak_finding_17_0.png" />
</div>
</div>
</section>
<section id="Find-maxima-with-an-automated-method:-find_peaks()">
<h2>Find maxima with an automated method: <code class="docutils literal notranslate"><span class="pre">find_peaks()</span></code><a class="headerlink" href="#Find-maxima-with-an-automated-method:-find_peaks()" title="Permalink to this heading">¶</a></h2>
<p>Exploring the spectra manually is useful, but cannot be made systematically in large datasets with many - possibly shifting peaks. The maxima of a given spectrum can be found automatically by the find_peaks() method which is based on <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.find_peaks.html">scpy.signal.find_peaks()</a>. It returns two outputs: <code class="docutils literal notranslate"><span class="pre">peaks</span></code> a NDDataset grouping the peak maxima (wavenumbers and absorbance) and <code class="docutils literal notranslate"><span class="pre">properties</span></code> a dictionary containing
properties of the returned peaks (it is empty if no particular option is selected, <a class="reference external" href="#options">see below</a> for more information).</p>
<section id="Default-behaviour">
<h3>Default behaviour<a class="headerlink" href="#Default-behaviour" title="Permalink to this heading">¶</a></h3>
<p>Applying this method on the last spectrum without any option will yield 7 peaks :</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">last</span> <span class="o">=</span> <span class="n">reg</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="p">(</span>
    <span class="n">peaks</span><span class="p">,</span>
    <span class="n">_</span><span class="p">,</span>
<span class="p">)</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">last</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">()</span>
<span class="p">)</span>  <span class="c1"># we do not catch the second output (properties) as it is void in this case</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">peaks</span></code> is a NDDataset. Its <code class="docutils literal notranslate"><span class="pre">x</span></code> attribute gives the peak position</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">peaks</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table><tbody><tr><th>Magnitude</th><td style='text-align:left;'><pre>[2266.372512520944 2220.4467738921926 ... 2077.112675131113 2073.144019440136]</pre></td></tr><tr><th>Units</th><td style='text-align:left;'>cm<sup>-1</sup></td></tr></tbody></table></div>
</div>
<p>The code below shows how the peaks found by this method can be marked on the plot:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">last</span><span class="o">.</span><span class="n">plot_pen</span><span class="p">()</span>  <span class="c1"># output the spectrum on ax. ax will receive next plot too</span>
<span class="n">pks</span> <span class="o">=</span> <span class="n">peaks</span> <span class="o">+</span> <span class="mf">0.01</span>  <span class="c1"># add a small offset on the y position of the markers</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">pks</span><span class="o">.</span><span class="n">plot_scatter</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;v&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
    <span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># we need to keep the previous output on ax</span>
    <span class="n">data_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># we dont need to redraw all things like labels, etc...</span>
    <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">),</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pks</span><span class="p">:</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="mf">0.02</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">m</span><span class="si">:</span><span class="s2">0.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span>
        <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
        <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;offset points&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/userguide_analysis_peak_finding_26_0.png" src="../../_images/userguide_analysis_peak_finding_26_0.png" />
</div>
</div>
<p>Now we will do a peak-finding for the whole dataset:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">peakslist</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">reg</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="k">for</span> <span class="n">peaks</span> <span class="ow">in</span> <span class="n">peakslist</span><span class="p">:</span>
    <span class="n">peaks</span><span class="o">.</span><span class="n">plot_scatter</span><span class="p">(</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;v&quot;</span><span class="p">,</span>
        <span class="n">ms</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
        <span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">data_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">),</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/userguide_analysis_peak_finding_29_0.png" src="../../_images/userguide_analysis_peak_finding_29_0.png" />
</div>
</div>
<p>It should be noted that this method finds only true maxima, not shoulders (!). For the detection of such underlying peaks, the use of methods based on derivatives or advanced detection methods - which will be treated in separate tutorial - are required. Once their maxima of a given peak have been found, it is possible, for instance, to plot its evolution with, e.g. the time. For instance for the peaks located at 2220-2180 cm<span class="math notranslate nohighlight">\(^{-1}\)</span>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find peak&#39;s position</span>
<span class="n">positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">reg</span><span class="p">[:,</span> <span class="mf">2220.0</span><span class="p">:</span><span class="mf">2180.0</span><span class="p">]]</span>

<span class="c1"># Make a NDDataset</span>
<span class="n">evol</span> <span class="o">=</span> <span class="n">scp</span><span class="o">.</span><span class="n">NDDataset</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;wavenumber at the maximum&quot;</span><span class="p">)</span>
<span class="n">evol</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">scp</span><span class="o">.</span><span class="n">Coord</span><span class="p">(</span>
    <span class="n">reg</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;acquisition time&quot;</span>
<span class="p">)</span>  <span class="c1"># the x coordinate is st to the acquisition time for each spectra</span>
<span class="n">evol</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">method_1D</span> <span class="o">=</span> <span class="s2">&quot;scatter+pen&quot;</span>

<span class="c1"># plot it</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">evol</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/userguide_analysis_peak_finding_31_0.png" src="../../_images/userguide_analysis_peak_finding_31_0.png" />
</div>
</div>
</section>
<section id="Options-of-find_peaks()">
<h3>Options of <code class="docutils literal notranslate"><span class="pre">find_peaks()</span></code><a class="headerlink" href="#Options-of-find_peaks()" title="Permalink to this heading">¶</a></h3>
<p>The default behaviour of find_peaks() will return <em>all</em> the detected maxima. The user can choose various options to select among these peaks:</p>
<p><strong>Parameters relative to “peak intensity”:</strong> - <code class="docutils literal notranslate"><span class="pre">height</span></code>: minimal required height of the peaks (single number) or minimal and maximal heights (sequence of two numbers) - <code class="docutils literal notranslate"><span class="pre">prominence</span></code>: minimal prominence of the peak to be detected (single number) or minimal and maximal prominence (sequence of 2 numbers). In brief the “prominence” of a peak measures how much a peak stands out from its surrounding and is the vertical distance between the peak and its lowest “contour line”. It should not be
confused with the height as a peak can have an important height but a small prominence when surrounded by other peaks (see below for an illustration). - in addition to the prominence, the user can define <code class="docutils literal notranslate"><span class="pre">wlen</span></code>, the width (in points) of the window used to look at neighboring minima, the peak maximum being is at the center of the window. - <code class="docutils literal notranslate"><span class="pre">threshold</span></code>: a single number (the minimal required threshold) or a sequence of two numbers (minimal and maximal). The thresholds are the difference of
height of the maximum with its two neighboring points (useful to detect spikes for instance)</p>
<p><strong>Parameters relative to “peak spacing”:</strong> - <code class="docutils literal notranslate"><span class="pre">distance</span></code>: the required minimal horizontal distance between neighbouring peaks. Smaller peaks are removed first. - <code class="docutils literal notranslate"><span class="pre">width</span></code>: Required minimal width of peaks in samples (single number) or minimal and maximal width. The width is assessed from the peak height, prominence and neighboring signal. - In addition the user can define <code class="docutils literal notranslate"><span class="pre">rel_height</span></code> (a float between 0. and 1.) used to compute the width - see the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.peak_widths.html">scipy
documentation</a> for further details. - Finally, we mention en passant a last parameter, <code class="docutils literal notranslate"><span class="pre">plateau_size()</span></code> used for selecting peaks having truly flat tops ( as in e.g. square-boxed signals).</p>
<p>The use of some of these options for the last spectrum of the dataset is exemplified in the following:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">reg</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<span class="c1"># we use squeeze it because one of the dimensions for this dataset of shape (1, N) is useless</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># default settings</span>
<span class="n">peaks</span><span class="p">,</span> <span class="n">properties</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">plot_pen</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">peaks</span><span class="o">.</span><span class="n">plot_scatter</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">data_only</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="c1"># find peaks heights than 0.05  (NB: the spectra are shifted for the display.</span>
<span class="c1"># Refer to the 1st spectrum for true heights)</span>
<span class="n">peaks</span><span class="p">,</span> <span class="n">properties</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span>
<span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;0.05&lt;height&quot;</span>
<span class="n">offset</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span><span class="o">.</span><span class="n">plot_pen</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="p">(</span><span class="n">peaks</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span><span class="o">.</span><span class="n">plot_scatter</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">data_only</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="c1"># find peaks heights between 0.05 and 0.2 (the highest peak won&#39;t be detected)</span>
<span class="n">peaks</span><span class="p">,</span> <span class="n">properties</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>
<span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span>
<span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;0.05&lt;height&lt;0.2&quot;</span>
<span class="n">offset</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span><span class="o">.</span><span class="n">plot_pen</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="p">(</span><span class="n">peaks</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span><span class="o">.</span><span class="n">plot_scatter</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">data_only</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="c1"># find peaks with prominence &gt;= 0.05 (only the two most prominent peaks are detected)</span>
<span class="n">peaks</span><span class="p">,</span> <span class="n">properties</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">prominence</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;purple&quot;</span>
<span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;prominence=0.05&quot;</span>
<span class="n">offset</span> <span class="o">=</span> <span class="mf">0.15</span>
<span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span><span class="o">.</span><span class="n">plot_pen</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="p">(</span><span class="n">peaks</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span><span class="o">.</span><span class="n">plot_scatter</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">data_only</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="c1"># find peaks with distance &gt;= 10 (only the highest of the two maxima at ~ 2075 is detected)</span>
<span class="n">peaks</span><span class="p">,</span> <span class="n">properties</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">distance</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span>
<span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;distance&gt;10&quot;</span>
<span class="n">offset</span> <span class="o">=</span> <span class="mf">0.20</span>
<span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span><span class="o">.</span><span class="n">plot_pen</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="p">(</span><span class="n">peaks</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span><span class="o">.</span><span class="n">plot_scatter</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">data_only</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="c1"># find peaks with width &gt;= 10 (none of the two maxima at ~ 2075 is detected)</span>
<span class="n">peaks</span><span class="p">,</span> <span class="n">properties</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;grey&quot;</span>
<span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;width&gt;10&quot;</span>
<span class="n">offset</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span><span class="o">.</span><span class="n">plot_pen</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="p">(</span><span class="n">peaks</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span><span class="o">.</span><span class="n">plot_scatter</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">data_only</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/userguide_analysis_peak_finding_35_0.png" src="../../_images/userguide_analysis_peak_finding_35_0.png" />
</div>
</div>
</section>
<section id="More-on-peak-properties">
<h3>More on peak properties<a class="headerlink" href="#More-on-peak-properties" title="Permalink to this heading">¶</a></h3>
<p>If the concept of “peak height” is pretty clear, it is worth examining further some peak properties as defined and used in <code class="docutils literal notranslate"><span class="pre">find_peaks()</span></code>. They can be obtained (and used) by passing the parameters <code class="docutils literal notranslate"><span class="pre">height</span></code>, <code class="docutils literal notranslate"><span class="pre">prominence</span></code>, <code class="docutils literal notranslate"><span class="pre">threshold</span></code> and <code class="docutils literal notranslate"><span class="pre">width</span></code>. Then <code class="docutils literal notranslate"><span class="pre">find_peaks()</span></code> will return the corresponding properties of the detected peaks in the <code class="docutils literal notranslate"><span class="pre">properties</span></code> dictionary.</p>
<section id="Prominence">
<h4>Prominence<a class="headerlink" href="#Prominence" title="Permalink to this heading">¶</a></h4>
<p>The prominence of a peak can be defined as the vertical distance from the peak’s maximum to <em>the lowest horizontal line passing through a minimum but not containing any higher peak</em>. This is illustrated below for the three most prominent peaks of the above spectra:</p>
<p><img alt="prominence_def" class="no-scaled-link" src="../../_images/prominence.png" style="width: 350px;" /></p>
<p>Let’s illustrate this for the second-highest peak which height is comprised between ~ 0.15 and 0.22 and see which properties are returned when, on top of <code class="docutils literal notranslate"><span class="pre">height</span></code>, we pass <code class="docutils literal notranslate"><span class="pre">prominence=0</span></code>: this will return the properties associated to the prominence and warrant that this peak will not be rejected on the prominence criterion.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">peaks</span><span class="p">,</span> <span class="n">properties</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="p">(</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.22</span><span class="p">),</span> <span class="n">prominence</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">properties</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;peak_heights&#39;: [0.19945645332336426 &lt;Unit(&#39;absorbance&#39;)&gt;],
 &#39;prominences&#39;: [0.06890010833740234 &lt;Unit(&#39;absorbance&#39;)&gt;],
 &#39;left_bases&#39;: [2299.7344161413444 &lt;Unit(&#39;centimeter^-1&#39;)&gt;],
 &#39;right_bases&#39;: [2142.561791474242 &lt;Unit(&#39;centimeter^-1&#39;)&gt;]}
</pre></div></div>
</div>
<p>The peak prominence is 0.0689, a much lower value than the height (0.1995), as could be expected by the illustration above.</p>
<p>The algorithm used to determine the left and right ‘bases’ is illustrated below: - (1) extend a line to the left and right of the maximum until it reaches the window border (here on the left) or the signal (here on the right). - (2) find the minimum value within the intervals defined above. These points are the peak’s bases. - (3) use the higher base (here the right base) and peak maximum to calculate the prominence.</p>
<p><img alt="prominence_algo" class="no-scaled-link" src="../../_images/prominence_algo.png" style="width: 350px;" /></p>
<p>The following code shows how to plot the maximum and the two “base points” from the previous output of <code class="docutils literal notranslate"><span class="pre">find_peaks()</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">plot_pen</span><span class="p">()</span>

<span class="c1"># plots the  maximum</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">peaks</span><span class="o">.</span><span class="n">plot_scatter</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">data_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">wl</span><span class="p">,</span> <span class="n">wr</span> <span class="o">=</span> <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;left_bases&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;right_bases&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># wavenumbers of of left and right bases</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">wr</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>  <span class="c1"># add vertical line at the bases</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="n">w</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
    <span class="c1"># and a red mark  #TODO: add function to plot this easily</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">2310.0</span><span class="p">,</span> <span class="mf">1900.0</span><span class="p">)</span>  <span class="c1"># change x limits to better see the &#39;left_base&#39;</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/userguide_analysis_peak_finding_39_0.png" src="../../_images/userguide_analysis_peak_finding_39_0.png" />
</div>
</div>
<p>We can check that the correct value of the peak prominence is obtained by the difference between its height and the highest base, here the ‘right_base’:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prominence</span> <span class="o">=</span> <span class="n">peaks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">wr</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;calc. prominence = </span><span class="si">{</span><span class="n">prominence</span><span class="si">:</span><span class="s2">0.4fK</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
calc. prominence = 0.0690 absorbance
</pre></div></div>
</div>
<p>Finally, the figure below shows how the prominence can be affected by <code class="docutils literal notranslate"><span class="pre">wlen</span></code>, the size of the window used to determine the peaks’ bases.</p>
<p><img alt="prominence_def" class="no-scaled-link" src="../../_images/prominence_wlen.png" style="width: 700px;" /></p>
<p>As illustrated above a reduction of the window should reduce the prominence of the peak. This impact can be checked with the code below:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">peak</span><span class="p">,</span> <span class="n">properties</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;prominence with full spectrum: </span><span class="si">{</span><span class="n">properties</span><span class="p">[</span><span class="s1">&#39;prominences&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">0.4fK</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">peak</span><span class="p">,</span> <span class="n">properties</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span>
    <span class="n">height</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">wlen</span><span class="o">=</span><span class="mf">50.0</span>
<span class="p">)</span>  <span class="c1"># a float should be explicitly passed, else will be considered as points</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;prominence with reduced window: </span><span class="si">{</span><span class="n">properties</span><span class="p">[</span><span class="s1">&#39;prominences&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">0.4fK</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
prominence with full spectrum: 0.2465 absorbance
prominence with reduced window: 0.1161 absorbance
</pre></div></div>
</div>
</section>
<section id="Width">
<h4>Width<a class="headerlink" href="#Width" title="Permalink to this heading">¶</a></h4>
<p>The find_peaks() method also returns the peak widths. As we will see below, the method is <strong>very approximate</strong> and more advanced methods (such as peak fitting), also implemented in spectrochempy should be used (see e.g., <a class="reference external" href="https://www.spectrochempy.fr/dev/gallery/auto_examples/fitting/plot_fit.html#sphx-glr-gallery-auto%20-examples-fitting-plot-fit-py">this example</a>). On the other hand, <strong>the magnitude of the width is generally fine</strong>.</p>
<p>This estimate is based on an algorithm similar to that used for the “bases” above, except that the horizontal line starts from a <code class="docutils literal notranslate"><span class="pre">width_height</span></code> computed from the peak height subtracted by a <em>fraction</em> of the peak prominence defined bay <code class="docutils literal notranslate"><span class="pre">rel_height</span></code> (default = 0.5). The algorithm is illustrated below for the two most prominent peaks:</p>
<p><img alt="width_algo" class="no-scaled-link" src="../../_images/width_algo.jpg" style="width: 900px;" /></p>
<p>When the <code class="docutils literal notranslate"><span class="pre">width</span></code> keyword is used, <code class="docutils literal notranslate"><span class="pre">properties</span></code> dictionary returns the prominence parameters (as it is used for the calculation of the width), the width and the left and right interpolated positions (“ips”) of the intersection of the horizontal line with the spectrum:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">peaks</span><span class="p">,</span> <span class="n">properties</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">properties</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;peak_heights&#39;: [0.24812382459640503 &lt;Unit(&#39;absorbance&#39;)&gt;],
 &#39;prominences&#39;: [0.24650186859071255 &lt;Unit(&#39;absorbance&#39;)&gt;],
 &#39;left_bases&#39;: [2299.7344161413444 &lt;Unit(&#39;centimeter^-1&#39;)&gt;],
 &#39;right_bases&#39;: [1899.5709852404398 &lt;Unit(&#39;centimeter^-1&#39;)&gt;],
 &#39;widths&#39;: [75.16388134369815 &lt;Unit(&#39;centimeter^-1&#39;)&gt;],
 &#39;width_heights&#39;: [0.12487289030104876 &lt;Unit(&#39;absorbance&#39;)&gt;],
 &#39;left_ips&#39;: [2166.0504707928103 &lt;Unit(&#39;centimeter^-1&#39;)&gt;],
 &#39;right_ips&#39;: [2090.8865894491123 &lt;Unit(&#39;centimeter^-1&#39;)&gt;]}
</pre></div></div>
</div>
<p>The code below shows how these data can be extracted and then plotted:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># extraction of data (for better readability of the code below)</span>
<span class="n">height</span> <span class="o">=</span> <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;peak_heights&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">width_height</span> <span class="o">=</span> <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;width_heights&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">wl</span> <span class="o">=</span> <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;left_ips&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">wr</span> <span class="o">=</span> <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;right_ips&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">plot_pen</span><span class="p">()</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">peaks</span><span class="o">.</span><span class="n">plot_scatter</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">data_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">width_height</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">wr</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/userguide_analysis_peak_finding_48_0.png" src="../../_images/userguide_analysis_peak_finding_48_0.png" />
</div>
</div>
<p>It is obvious here that the peak width is overestimated in the present case due to the presence of the second peak on the left. Here a better estimate would be obtained by considering the right half-width, or reducing the <code class="docutils literal notranslate"><span class="pre">rel_height</span></code> parameter as shown below.</p>
</section>
</section>
<section id="A-code-snippet-to-display-properties">
<h3>A code snippet to display properties<a class="headerlink" href="#A-code-snippet-to-display-properties" title="Permalink to this heading">¶</a></h3>
<p>The self-contained code snippet below can be used to display in a matplotlib plot and print the various peak properties of a single peak as returned by <code class="docutils literal notranslate"><span class="pre">find_peaks()</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># user defined parameters ------------------------------</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">reg</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># define a single-row NDDataset</span>
<span class="n">s</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">method_1D</span> <span class="o">=</span> <span class="s2">&quot;pen&quot;</span>

<span class="c1"># peak selection parameters; should be set to return a single peak</span>
<span class="n">height</span> <span class="o">=</span> <span class="mf">0.08</span>  <span class="c1"># minimal height or min and max heights)</span>
<span class="n">prominence</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># minimal prominence or min and max prominences</span>
<span class="n">width</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># minimal width or min and max widths</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># minimal threshold or min and max threshold)</span>

<span class="c1"># prominence and width parameter</span>
<span class="n">wlen</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># the length of the window used to compute the prominence</span>
<span class="n">rel_height</span> <span class="o">=</span> <span class="mf">0.47</span>  <span class="c1"># the fraction of the prominence used to compute the width</span>

<span class="c1"># code: find peaks, plot and print properties -------------------</span>
<span class="n">peaks</span><span class="p">,</span> <span class="n">properties</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span>
    <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
    <span class="n">prominence</span><span class="o">=</span><span class="n">prominence</span><span class="p">,</span>
    <span class="n">wlen</span><span class="o">=</span><span class="n">wlen</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
    <span class="n">rel_height</span><span class="o">=</span><span class="n">rel_height</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">table_pos</span> <span class="o">=</span> <span class="s2">&quot;  &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">peaks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">m</span><span class="si">:</span><span class="s2">&gt;10.3f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">))])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;peak_position (cm⁻¹)&quot;</span><span class="si">:</span><span class="s1">&gt;26</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">table_pos</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
    <span class="n">table_property</span> <span class="o">=</span> <span class="s2">&quot;  &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">properties</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">m</span><span class="si">:</span><span class="s2">&gt;10.3f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">))]</span>
    <span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">:</span><span class="s2">&gt;.16</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">properties</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">u</span><span class="si">:</span><span class="s2">~P</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">:</span><span class="s2">&gt;26</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">table_property</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">peaks</span><span class="o">.</span><span class="n">plot_scatter</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">data_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="p">(</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;left_bases&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;right_bases&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">w</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="p">(</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;left_ips&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;right_ips&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
      peak_position (cm⁻¹):   2186.058    2157.805    2115.084    2077.113    2073.144
       peak_heights (a.u.):      0.090       0.199       0.248       0.106       0.106
        prominences (a.u.):      0.018       0.069       0.247       0.000       0.001
         left_bases (cm⁻¹):   2299.734    2299.734    2299.734    2078.921    2075.064
        right_bases (cm⁻¹):   2173.418    2142.562    1899.571    2075.064    1899.571
             widths (cm⁻¹):     12.746      10.623      47.242       1.180       1.968
      width_heights (a.u.):      0.081       0.167       0.132       0.105       0.106
           left_ips (cm⁻¹):   2191.976    2162.881    2140.474    2077.730    2074.135
          right_ips (cm⁻¹):   2179.230    2152.258    2093.232    2076.549    2072.168
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/userguide_analysis_peak_finding_51_1.png" src="../../_images/userguide_analysis_peak_finding_51_1.png" />
</div>
</div>
<p>– this is the end of this tutorial –</p>
</section>
</section>
</section>


           </div>
          </div>

          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="analysis.html" class="btn btn-neutral float-left" title="Analysis" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="peak_integration.html" class="btn btn-neutral float-right" title="Peak integration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2014-2022 - A.Travert &amp; C.Fernandez @ LCS.
      <span class="lastupdated">Last updated on Oct 14, 2022.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>